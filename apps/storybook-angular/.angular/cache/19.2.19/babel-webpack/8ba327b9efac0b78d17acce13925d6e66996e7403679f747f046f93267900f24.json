{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"/Users/mparrino/Documents/galactik/galactik/node_modules/.pnpm/@babel+runtime@7.26.10/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AbstractRenderer = exports.STORY_UID_ATTRIBUTE = void 0;\nconst platform_browser_1 = require(\"@angular/platform-browser\");\nconst rxjs_1 = require(\"rxjs\");\nconst telejson_1 = require(\"telejson\");\nconst StorybookModule_1 = require(\"./StorybookModule\");\nconst StorybookProvider_1 = require(\"./StorybookProvider\");\nconst PropertyExtractor_1 = require(\"./utils/PropertyExtractor\");\nconst BootstrapQueue_1 = require(\"./utils/BootstrapQueue\");\nconst applicationRefs = new Map();\n/**\n * Attribute name for the story UID that may be written to the targetDOMNode.\n *\n * If a target DOM node has a story UID attribute, it will be used as part of\n * the selector for the Angular component.\n */\nexports.STORY_UID_ATTRIBUTE = 'data-sb-story-uid';\nclass AbstractRenderer {\n  constructor() {\n    this.previousStoryRenderInfo = new Map();\n  }\n  /**\n   * Wait and destroy the platform\n   */\n  static resetApplications(domNode) {\n    applicationRefs.forEach((appRef, appDOMNode) => {\n      if (!appRef.destroyed && (!domNode || appDOMNode === domNode)) {\n        appRef.destroy();\n      }\n    });\n  }\n  /**\n   * Bootstrap main angular module with main component or send only new `props` with storyProps$\n   *\n   * @param storyFnAngular {StoryFnAngularReturnType}\n   * @param forced {boolean} If :\n   * - true render will only use the StoryFn `props' in storyProps observable that will update sotry's component/template properties. Improves performance without reloading the whole module&component if props changes\n   * - false fully recharges or initializes angular module & component\n   * @param component {Component}\n   */\n  render(_x) {\n    var _this = this;\n    return _asyncToGenerator(function* ({\n      storyFnAngular,\n      forced,\n      component,\n      targetDOMNode\n    }) {\n      const targetSelector = _this.generateTargetSelectorFromStoryId(targetDOMNode.id);\n      const newStoryProps$ = new rxjs_1.BehaviorSubject(storyFnAngular.props);\n      if (!_this.fullRendererRequired({\n        targetDOMNode,\n        storyFnAngular,\n        moduleMetadata: {\n          ...storyFnAngular.moduleMetadata\n        },\n        forced\n      })) {\n        _this.storyProps$.next(storyFnAngular.props);\n        return;\n      }\n      yield _this.beforeFullRender(targetDOMNode);\n      // Complete last BehaviorSubject and set a new one for the current module\n      if (_this.storyProps$) {\n        _this.storyProps$.complete();\n      }\n      _this.storyProps$ = newStoryProps$;\n      _this.initAngularRootElement(targetDOMNode, targetSelector);\n      const analyzedMetadata = new PropertyExtractor_1.PropertyExtractor(storyFnAngular.moduleMetadata, component);\n      const storyUid = targetDOMNode.getAttribute(exports.STORY_UID_ATTRIBUTE);\n      const componentSelector = storyUid !== null ? `${targetSelector}[${storyUid}]` : targetSelector;\n      if (storyUid !== null) {\n        const element = targetDOMNode.querySelector(targetSelector);\n        element.toggleAttribute(storyUid, true);\n      }\n      const application = (0, StorybookModule_1.getApplication)({\n        storyFnAngular,\n        component,\n        targetSelector: componentSelector,\n        analyzedMetadata\n      });\n      const applicationRef = yield (0, BootstrapQueue_1.queueBootstrapping)(() => {\n        return (0, platform_browser_1.bootstrapApplication)(application, {\n          ...storyFnAngular.applicationConfig,\n          providers: [(0, StorybookProvider_1.storyPropsProvider)(newStoryProps$), ...analyzedMetadata.applicationProviders, ...(storyFnAngular.applicationConfig?.providers ?? [])]\n        });\n      });\n      applicationRefs.set(targetDOMNode, applicationRef);\n    }).apply(this, arguments);\n  }\n  /**\n   * Only ASCII alphanumerics can be used as HTML tag name.\n   * https://html.spec.whatwg.org/#elements-2\n   *\n   * Therefore, stories break when non-ASCII alphanumerics are included in target selector.\n   * https://github.com/storybookjs/storybook/issues/15147\n   *\n   * This method returns storyId when it doesn't contain any non-ASCII alphanumerics.\n   * Otherwise, it generates a valid HTML tag name from storyId by removing non-ASCII alphanumerics from storyId, prefixing \"sb-\", and suffixing \"-component\"\n   * @protected\n   * @memberof AbstractRenderer\n   */\n  generateTargetSelectorFromStoryId(id) {\n    const invalidHtmlTag = /[^A-Za-z0-9-]/g;\n    const storyIdIsInvalidHtmlTagName = invalidHtmlTag.test(id);\n    return storyIdIsInvalidHtmlTagName ? `sb-${id.replace(invalidHtmlTag, '')}-component` : id;\n  }\n  /**\n   * Adds DOM element that angular will use as bootstrap component.\n   */\n  initAngularRootElement(targetDOMNode, targetSelector) {\n    targetDOMNode.innerHTML = '';\n    targetDOMNode.appendChild(document.createElement(targetSelector));\n  }\n  fullRendererRequired({\n    targetDOMNode,\n    storyFnAngular,\n    moduleMetadata,\n    forced\n  }) {\n    const previousStoryRenderInfo = this.previousStoryRenderInfo.get(targetDOMNode);\n    const currentStoryRender = {\n      storyFnAngular,\n      moduleMetadataSnapshot: (0, telejson_1.stringify)(moduleMetadata, {\n        allowFunction: false\n      })\n    };\n    this.previousStoryRenderInfo.set(targetDOMNode, currentStoryRender);\n    if (\n    // check `forceRender` of story RenderContext\n    !forced ||\n    // if it's the first rendering and storyProps$ is not init\n    !this.storyProps$) {\n      return true;\n    }\n    // force the rendering if the template has changed\n    const hasChangedTemplate = !!storyFnAngular?.template && previousStoryRenderInfo?.storyFnAngular?.template !== storyFnAngular.template;\n    if (hasChangedTemplate) {\n      return true;\n    }\n    // force the rendering if the metadata structure has changed\n    const hasChangedModuleMetadata = currentStoryRender.moduleMetadataSnapshot !== previousStoryRenderInfo?.moduleMetadataSnapshot;\n    return hasChangedModuleMetadata;\n  }\n}\nexports.AbstractRenderer = AbstractRenderer;","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","AbstractRenderer","STORY_UID_ATTRIBUTE","platform_browser_1","rxjs_1","telejson_1","StorybookModule_1","StorybookProvider_1","PropertyExtractor_1","BootstrapQueue_1","applicationRefs","Map","constructor","previousStoryRenderInfo","resetApplications","domNode","forEach","appRef","appDOMNode","destroyed","destroy","render","_x","_this","storyFnAngular","forced","component","targetDOMNode","targetSelector","generateTargetSelectorFromStoryId","id","newStoryProps$","BehaviorSubject","props","fullRendererRequired","moduleMetadata","storyProps$","next","beforeFullRender","complete","initAngularRootElement","analyzedMetadata","PropertyExtractor","storyUid","getAttribute","componentSelector","element","querySelector","toggleAttribute","application","getApplication","applicationRef","queueBootstrapping","bootstrapApplication","applicationConfig","providers","storyPropsProvider","applicationProviders","set","apply","arguments","invalidHtmlTag","storyIdIsInvalidHtmlTagName","test","replace","innerHTML","appendChild","document","createElement","get","currentStoryRender","moduleMetadataSnapshot","stringify","allowFunction","hasChangedTemplate","template","hasChangedModuleMetadata"],"sources":["/Users/mparrino/Documents/galactik/galactik/node_modules/.pnpm/@storybook+angular@8.2.7_a5f4cac230146468d6cb7e7c7992c894/node_modules/@storybook/angular/dist/client/angular-beta/AbstractRenderer.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AbstractRenderer = exports.STORY_UID_ATTRIBUTE = void 0;\nconst platform_browser_1 = require(\"@angular/platform-browser\");\nconst rxjs_1 = require(\"rxjs\");\nconst telejson_1 = require(\"telejson\");\nconst StorybookModule_1 = require(\"./StorybookModule\");\nconst StorybookProvider_1 = require(\"./StorybookProvider\");\nconst PropertyExtractor_1 = require(\"./utils/PropertyExtractor\");\nconst BootstrapQueue_1 = require(\"./utils/BootstrapQueue\");\nconst applicationRefs = new Map();\n/**\n * Attribute name for the story UID that may be written to the targetDOMNode.\n *\n * If a target DOM node has a story UID attribute, it will be used as part of\n * the selector for the Angular component.\n */\nexports.STORY_UID_ATTRIBUTE = 'data-sb-story-uid';\nclass AbstractRenderer {\n    constructor() {\n        this.previousStoryRenderInfo = new Map();\n    }\n    /**\n     * Wait and destroy the platform\n     */\n    static resetApplications(domNode) {\n        applicationRefs.forEach((appRef, appDOMNode) => {\n            if (!appRef.destroyed && (!domNode || appDOMNode === domNode)) {\n                appRef.destroy();\n            }\n        });\n    }\n    /**\n     * Bootstrap main angular module with main component or send only new `props` with storyProps$\n     *\n     * @param storyFnAngular {StoryFnAngularReturnType}\n     * @param forced {boolean} If :\n     * - true render will only use the StoryFn `props' in storyProps observable that will update sotry's component/template properties. Improves performance without reloading the whole module&component if props changes\n     * - false fully recharges or initializes angular module & component\n     * @param component {Component}\n     */\n    async render({ storyFnAngular, forced, component, targetDOMNode, }) {\n        const targetSelector = this.generateTargetSelectorFromStoryId(targetDOMNode.id);\n        const newStoryProps$ = new rxjs_1.BehaviorSubject(storyFnAngular.props);\n        if (!this.fullRendererRequired({\n            targetDOMNode,\n            storyFnAngular,\n            moduleMetadata: {\n                ...storyFnAngular.moduleMetadata,\n            },\n            forced,\n        })) {\n            this.storyProps$.next(storyFnAngular.props);\n            return;\n        }\n        await this.beforeFullRender(targetDOMNode);\n        // Complete last BehaviorSubject and set a new one for the current module\n        if (this.storyProps$) {\n            this.storyProps$.complete();\n        }\n        this.storyProps$ = newStoryProps$;\n        this.initAngularRootElement(targetDOMNode, targetSelector);\n        const analyzedMetadata = new PropertyExtractor_1.PropertyExtractor(storyFnAngular.moduleMetadata, component);\n        const storyUid = targetDOMNode.getAttribute(exports.STORY_UID_ATTRIBUTE);\n        const componentSelector = storyUid !== null ? `${targetSelector}[${storyUid}]` : targetSelector;\n        if (storyUid !== null) {\n            const element = targetDOMNode.querySelector(targetSelector);\n            element.toggleAttribute(storyUid, true);\n        }\n        const application = (0, StorybookModule_1.getApplication)({\n            storyFnAngular,\n            component,\n            targetSelector: componentSelector,\n            analyzedMetadata,\n        });\n        const applicationRef = await (0, BootstrapQueue_1.queueBootstrapping)(() => {\n            return (0, platform_browser_1.bootstrapApplication)(application, {\n                ...storyFnAngular.applicationConfig,\n                providers: [\n                    (0, StorybookProvider_1.storyPropsProvider)(newStoryProps$),\n                    ...analyzedMetadata.applicationProviders,\n                    ...(storyFnAngular.applicationConfig?.providers ?? []),\n                ],\n            });\n        });\n        applicationRefs.set(targetDOMNode, applicationRef);\n    }\n    /**\n     * Only ASCII alphanumerics can be used as HTML tag name.\n     * https://html.spec.whatwg.org/#elements-2\n     *\n     * Therefore, stories break when non-ASCII alphanumerics are included in target selector.\n     * https://github.com/storybookjs/storybook/issues/15147\n     *\n     * This method returns storyId when it doesn't contain any non-ASCII alphanumerics.\n     * Otherwise, it generates a valid HTML tag name from storyId by removing non-ASCII alphanumerics from storyId, prefixing \"sb-\", and suffixing \"-component\"\n     * @protected\n     * @memberof AbstractRenderer\n     */\n    generateTargetSelectorFromStoryId(id) {\n        const invalidHtmlTag = /[^A-Za-z0-9-]/g;\n        const storyIdIsInvalidHtmlTagName = invalidHtmlTag.test(id);\n        return storyIdIsInvalidHtmlTagName ? `sb-${id.replace(invalidHtmlTag, '')}-component` : id;\n    }\n    /**\n     * Adds DOM element that angular will use as bootstrap component.\n     */\n    initAngularRootElement(targetDOMNode, targetSelector) {\n        targetDOMNode.innerHTML = '';\n        targetDOMNode.appendChild(document.createElement(targetSelector));\n    }\n    fullRendererRequired({ targetDOMNode, storyFnAngular, moduleMetadata, forced, }) {\n        const previousStoryRenderInfo = this.previousStoryRenderInfo.get(targetDOMNode);\n        const currentStoryRender = {\n            storyFnAngular,\n            moduleMetadataSnapshot: (0, telejson_1.stringify)(moduleMetadata, { allowFunction: false }),\n        };\n        this.previousStoryRenderInfo.set(targetDOMNode, currentStoryRender);\n        if (\n        // check `forceRender` of story RenderContext\n        !forced ||\n            // if it's the first rendering and storyProps$ is not init\n            !this.storyProps$) {\n            return true;\n        }\n        // force the rendering if the template has changed\n        const hasChangedTemplate = !!storyFnAngular?.template &&\n            previousStoryRenderInfo?.storyFnAngular?.template !== storyFnAngular.template;\n        if (hasChangedTemplate) {\n            return true;\n        }\n        // force the rendering if the metadata structure has changed\n        const hasChangedModuleMetadata = currentStoryRender.moduleMetadataSnapshot !== previousStoryRenderInfo?.moduleMetadataSnapshot;\n        return hasChangedModuleMetadata;\n    }\n}\nexports.AbstractRenderer = AbstractRenderer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}